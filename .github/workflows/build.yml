name: build


on:

  push:
    branches: [ "master" ]
  workflow_dispatch:

jobs:

  build:
    runs-on: ubuntu-latest

    steps:

      - uses: actions/checkout@v3

      - name: Install flatpak and flatpak-builder
        run: sudo apt install flatpak flatpak-builder -y
        
      - name: add falthub repo
        run: sudo flatpak remote-add --if-not-exists flathub https://flathub.org/repo/flathub.flatpakrepo

      - name: Build flatpak bundle
        run: |
          mkdir build
          sudo flatpak-builder --install-deps-from=flathub build org.polymc.PolyMC.yml
          flatpak build-export export build
          flatpak build-bundle export "org.polymc.PolyMC.flatpak" org.polymc.PolyMC --runtime-repo=https://flathub.org/repo/flathub.flatpakrepo
          
      - name: Upload a Build Artifact
        uses: actions/upload-artifact@v3.1.0
        with:
          path: org.polymc.PolyMC.flatpak
